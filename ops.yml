dependencies:
  brew:
    - crystal
  custom:
    - shards
hooks:
  before:
    - mkdir -p bin/release bin/debug
actions:
  build-release:
    command: SHARDS_BIN_PATH=bin/release shards build $APP --release
    description: Build for release
    alias: br
  build-debug:
    command: SHARDS_BIN_PATH=bin/debug shards build $APP --debug
    description: Build for development (debugging)
    aliases: [build, bd]
  install:
    command: |
      BRANCH=$(git branch --show-current)
      [ "$BRANCH" == "main" ] || echo 1>&2 "$0: WARNING: not on 'main' branch."

      if [ -e "$INSTALL_DIR" ]; then
        ops build-release && cp bin/release/enkaidu "$INSTALL_DIR/"
      else
        echo 1>&2 "$0: The directory '$INSTALL_DIR' does not exist."
      fi
  run:
    command: ops build-debug && bin/debug/$APP
    load_secrets: true
  run_release:
    command: ops build-release && bin/release/$APP
    alias: rr
    description: Build for release and then run the app
    load_secrets: true
  clean:
    command: rm -rf bin/debug/* && rm -rf bin/release/*
    description: Clear prior builds
  wipe:
    command: crystal clear_cache && ops clean
    description: Clear build caches and prior builds
  lint:
    command: bin/ameba --all
options:
  environment:
    APP: enkaidu
    INSTALL_DIR: "$HOME/bin"
